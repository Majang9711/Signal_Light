<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>SIGNAL LIGHT TIME CHECK</title>
</head>

<body>

    <div id=0>0</div>
    <div id=1>1</div>
    <div id=2>2</div>
    <div id=3>3</div>
    <div id=4>4</div>
    <div id=5>5</div>
    <div id=6>6</div>
    <div id=7>7</div>
    <div id=8>8</div>
    <div id=9>9</div>

    <script type="text/javascript">

    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
        import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDcD05ygDPQI6DQzkI_FXYIykYXJVC1Ehc",
            authDomain: "signal-light-2b204.firebaseapp.com",
            databaseURL: "https://signal-light-2b204-default-rtdb.firebaseio.com",
            projectId: "signal-light-2b204",
            storageBucket: "signal-light-2b204.appspot.com",
            messagingSenderId: "1015284448696",
            appId: "1:1015284448696:web:9ae863fdc17a51f195e34d",
            measurementId: "G-BTFW41M2E2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        let timer = setInterval(() => incressTime(), 10);
        var greenState = "Green";
        var redState = "Red";
        var time = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0);

        function incressTime() {
            time[0] += 10;
            time[1] += 10;
            time[2] += 10;
            time[3] += 10;
            time[4] += 10;
            time[5] += 10;
            time[6] += 10;
            time[7] += 10;
            time[8] += 10;
            time[9] += 10;

            signal_0(42.29, 119.45, 0);
            signal_0(26.01, 53.95, 1);
            signal_0(26.01, 53.95, 2);
            signal_0(26.01, 53.95, 3);
            signal_0(26.01, 53.95, 4);
            signal_0(24.06, 54.85, 5);
            signal_0(25.06, 102.73, 6);
            signal_0(24.56, 45.4, 7);
            signal_0(31.06, 38.87, 8);
            signal_0(31.04, 38.96, 9);
        }

        function signal_0(on_ts, off_ts, id) {

            let result_On_ts = (on_ts / 0.01) * 10;
            let result_off_ts = (off_ts / 0.01) * 10;

            document.getElementById(id).innerHTML = id + ":" + greenState + ":" + time[id] + ",";
            const db = getDatabase();
            let nowTimes = (time[id] * 0.01) / 10;
            set(ref(db, 'users/' + id), {
                on: on_ts,
                off: off_ts,
                total: on_ts + off_ts,
                id: id,
                state: greenState,
                nowTime: nowTimes,
            });


            if (time[id] <= result_off_ts) //1분 59.45초
            {
                if (time[id] <= result_On_ts) //42.29초
                {
                    document.getElementById(id).innerHTML = id + ":" + greenState + ":" + time[id] + ",";
                    set(ref(db, 'users/' + id), {
                        on: on_ts,
                        off: off_ts,
                        total: on_ts + off_ts,
                        id: id,
                        state: greenState,
                        nowTime: nowTimes,
                    });
                }
                else if (time[id] > result_On_ts && time[id] < result_off_ts) //1분 17.16초
                {
                    document.getElementById(id).innerHTML = id + ":" + redState + ":" + time[id] + ",";
                    set(ref(db, 'users/' + id), {
                        on: on_ts,
                        off: off_ts,
                        total: on_ts + off_ts,
                        id: id,
                        state: redState,
                        nowTime: nowTimes,
                    });
                }
                else if (time[id] == result_off_ts) {
                    time[id] = 10;
                }
            }
        }

    </script>
</body>
</html>