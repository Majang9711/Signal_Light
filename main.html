<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>SIGNAL LIGHT TIME CHECK 10</title>
</head>

<body>
    <div id=0>0</div>
    <div id=1>1</div>
    <div id=2>2</div>
    <div id=3>3</div>
    <div id=4>4</div>
    <div id=5>5</div>
    <div id=6>6</div>
    <div id=7>7</div>
    <div id=8>8</div>
    <div id=9>9</div>

    <script type="text/javascript">

    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
        import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDcD05ygDPQI6DQzkI_FXYIykYXJVC1Ehc",
            authDomain: "signal-light-2b204.firebaseapp.com",
            databaseURL: "https://signal-light-2b204-default-rtdb.firebaseio.com",
            projectId: "signal-light-2b204",
            storageBucket: "signal-light-2b204.appspot.com",
            messagingSenderId: "1015284448696",
            appId: "1:1015284448696:web:9ae863fdc17a51f195e34d",
            measurementId: "G-BTFW41M2E2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        let timer = 0;
        var greenState = "Green";
        var redState = "Red";
        var time = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0);

        timer = setInterval(() => main_main(), 1000);

        
        let hh = 16, mm = 32, ss = 36;
        var oldhh = hh, oldmm = mm, oldss = ss;
        function main_main() {
            let today = new Date();
            let y = today.getFullYear();
            let month = today.getMonth() + 1; //현재시간중 달은 0부터 시작이라서 +1
            if ((month + "").length < 2) {
                month = "0" + month;   //달의 숫자가 1자리면 앞에 0을 붙임.
            }
            let d = today.getDate();
            if ((d + "").length < 2) {
                d = "0" + d;
            }
            let h = today.getHours(); //now h
            if ((h + "").length < 2) {
                h = "0" + h;
            }
            let m = today.getMinutes(); //now m
            if ((m + "").length < 2) {
                m = "0" + m;
            }
            let s = today.getSeconds(); //now s
            if ((s + "").length < 2) {
                s = "0" + s;
            }

            

            let nowYHMS = y + "" + month + "" + d + "" + h + "" + m + "" + s;


            document.getElementById(7).innerHTML = 7 + ":" +Math.floor(hh) + ":" + Math.floor(mm) + ":" + Math.floor(ss);


            

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + "172200") // 172200
            {
                time[0] = 0;
            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + "172200") // 172200
            {
                incressTime_0();
            }

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + Math.floor(hh) + "" + Math.floor(mm) + "" + Math.floor(ss)) { //000036  hh + "" + mm + "" + ss
                time[1] = 28000;
                time[2] = 28000;
                time[3] = 28000;
                time[4] = 28000;
                oldhh = hh;
                oldmm = mm;
                oldss = ss;
                let total_ss = ss + 80;
                if (total_ss % 60 != 0) {
                    ss = total_ss % 60;
                    mm = mm + (total_ss / 60);
                    if (mm >= 60) {
                        mm = mm % 60;
                        hh = hh + (mm / 60);
                    }
                }
                hh = Math.floor(hh);
                mm = Math.floor(mm);
                ss = Math.floor(ss);
                if ((hh + "").length < 2) {
                    hh = "0" + hh;
                }
                if ((mm + "").length < 2) {
                    mm = "0" + mm;
                }
                if ((ss + "").length < 2) {
                    ss = "0" + ss;
                }

                
                document.getElementById(8).innerHTML = 8 + ":" +oldhh + ":" + oldmm + ":" + oldss;



            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + oldhh + "" + oldmm + "" + oldss ) { //000036
                incressTime_1();
                incressTime_2();
                incressTime_3();
                incressTime_4();
            } else {
                // incressTime_1();
                // incressTime_2();
                // incressTime_3();
                // incressTime_4();
            }

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + "000030") { // 000030 
                time[5] = 28000;
            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + "000030") { // 000030 
                incressTime_5();
            } else {
                incressTime_5();
            }

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + "175151") { // 175151
                time[6] = 0;
            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + "175151") { // 175151
                incressTime_6();
            }

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + "175809") { // 175809
                time[7] = 0;
            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + "175809") { // 175809
                incressTime_7();
            }

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + "170314") { // 170314
                time[8] = 0;
            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + "170314") { // 170314
                incressTime_8();
            }

            if (eval(nowYHMS) == y + "" + month + "" + d + "" + "170644") { // 170644
                time[9] = 0;
            } else if (eval(nowYHMS) > y + "" + month + "" + d + "" + "170644") { // 170644
                incressTime_9();
            }

        }

        function incressTime_0() {
            time[0] += 1000;
            signal_0(42.0, 120.0, 0);
        }
        function incressTime_1() {
            time[1] += 1000;
            signal_0(26.0, 54.0, 1);
        }
        function incressTime_2() {
            time[2] += 1000;
            signal_0(26.0, 54.0, 2);
        }
        function incressTime_3() {
            time[3] += 1000;
            signal_0(26.0, 54.0, 3);
        }
        function incressTime_4() {
            time[4] += 1000;
            signal_0(26.0, 54.0, 4);
        }
        function incressTime_5() {
            time[5] += 1000;
            signal_0(25.0, 55.0, 5);
        }
        function incressTime_6() {
            time[6] += 1000;
            signal_0(25.0, 103.0, 6);
        }
        function incressTime_7() {
            time[7] += 1000;
            signal_0(25.0, 45.0, 7);
        }
        function incressTime_8() {
            time[8] += 1000;
            signal_0(31.0, 39.0, 8);
        }
        function incressTime_9() {
            time[9] += 1000;
            signal_0(31.0, 39.0, 9);
        }

        function signal_0(on_ts, off_ts, id) {

            let result_On_ts = (on_ts / 0.01) * 10;
            let result_off_ts = (off_ts / 0.01) * 10;

            document.getElementById(id).innerHTML = id + ":" + greenState + ":" + time[id] + ",";
            const db = getDatabase();
            let nowTimes = (time[id] * 0.01) / 10;
            let total = result_On_ts + result_off_ts; //전체 시간


            if (time[id] <= total) //1분 59.45초
            {
                if (time[id] <= result_On_ts) //42.29초
                {
                    document.getElementById(id).innerHTML = id + ":" + greenState + ":" + time[id] + ",";
                    set(ref(db, 'users/' + id), {
                        on: on_ts,
                        off: off_ts,
                        total: on_ts + off_ts,
                        id: id,
                        state: greenState,
                        nowTime: nowTimes,
                    });
                }
                else if (time[id] > result_On_ts && time[id] < total) //1분 17.16초
                {
                    document.getElementById(id).innerHTML = id + ":" + redState + ":" + time[id] + ",";
                    set(ref(db, 'users/' + id), {
                        on: on_ts,
                        off: off_ts,
                        total: total,
                        id: id,
                        state: redState,
                        nowTime: nowTimes,
                    });
                }
            } else {
                time[id] = 0;
            }
        }

    </script>
</body>

</html>
