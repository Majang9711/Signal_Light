<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>SIGNAL LIGHT TIME CHECK</title>
</head>
<body>
    <div id=0>0</div>
    <div id=1>1</div>
    <div id=2>2</div>
    <div id=3>3</div>
    <div id=4>4</div>
    <div id=5>5</div>
    <div id=6>6</div>
    <div id=7>7</div>
    <div id=8>8</div>
    <div id=9>9</div>

    <script type="text/javascript">

    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
        import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDcD05ygDPQI6DQzkI_FXYIykYXJVC1Ehc",
            authDomain: "signal-light-2b204.firebaseapp.com",
            databaseURL: "https://signal-light-2b204-default-rtdb.firebaseio.com",
            projectId: "signal-light-2b204",
            storageBucket: "signal-light-2b204.appspot.com",
            messagingSenderId: "1015284448696",
            appId: "1:1015284448696:web:9ae863fdc17a51f195e34d",
            measurementId: "G-BTFW41M2E2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        let timer = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        var greenState = "Green";
        var redState = "Red";
        var time = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        
        var isTrue =  new Array(false, false, false, false, false, false, false, false, false, false); // true이면 카운트 실행, false이면 카운트 실행
        var isMainTrue = new Array(false, false, false, false, false, false, false, false, false, false); //true로 바꾸는 것을 제어하는
        
        let today = new Date();
        let y = today.getFullYear();
        let month = today.getMonth()+1; //현재시간중 달은 0부터 시작이라서 +1
        if((month+"").length < 2){
            month="0"+month;   //달의 숫자가 1자리면 앞에 0을 붙임.
        }
        let d = today.getDate();
        if((d+"").d < 2){
            d="0"+d;   
        }
        let h = today.getHours(); //now h
        if((h+"").h < 2){
            h="0"+h;   
        }
        let m = today.getMinutes(); //now m
        if((m+"").m < 2){
            m="0"+m;   
        }
        let s = today.getSeconds(); //now s
        if((s+"").s < 2){
            s="0"+s;   
        }

        let nowYHMS = y + "" + month + "" + d + "" + h + "" + m + "" + s;
        
        // if(isMainTrue[0] == false || isMainTrue[1] == false || isMainTrue[3] == false || isMainTrue[4] == false || isMainTrue[5] == false || isMainTrue[6] == false || isMainTrue[7] == false || isMainTrue[8] == false)

        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072500) // 172200
        {
            isTrue[0] = true;
            isMainTrue[0] = true;
            time[0] = 0;
        }
        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072510){ //172530
            isTrue[1] = true;
            isTrue[2] = true;
            isTrue[3] = true;
            isTrue[4] = true;
            isMainTrue[1] = true;
            isMainTrue[2] = true;
            isMainTrue[3] = true;
            isMainTrue[4] = true;
            time[1] = 0;
            time[2] = 0;
            time[3] = 0;
            time[4] = 0;
        }
        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072600){ // 172920
            isTrue[5] = true;
            isMainTrue[5] = true;
            time[5] = 0;
        }
        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072640){ // 175151
            isTrue[6] = true;
            isMainTrue[6] = true;
            time[6] = 0;
        }
        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072502){ // 175809
            isTrue[7] = true;
            isMainTrue[7] = true;
            time[7] = 0;
        }
        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072504){ // 170314
            isTrue[8] = true;
            isMainTrue[8] = true;
            time[8] = 0;
        }
        if(eval(nowYHMS) >= y + "" + month + "" + d + "" + 072509){ // 170644
            isTrue[9] = true;
            isMainTrue[9] = true;
            time[9] = 0;
        }


        //증가
        if(isTrue[0] == true)
        {
            timer[0] = setInterval(() => incressTime_0(), 10);
        }
        if(isTrue[1] == true)
        {
            
            timer[1] = setInterval(() => incressTime_1(), 10);
            timer[2] = setInterval(() => incressTime_2(), 10);
            timer[3] = setInterval(() => incressTime_3(), 10);
            timer[4] = setInterval(() => incressTime_4(), 10);
        }
        if(isTrue[5] == true)
        {
            timer[5] = setInterval(() => incressTime_5(), 10);
        }
        if(isTrue[6] == true)
        {
            timer[6] = setInterval(() => incressTime_6(), 10);
        }
        if(isTrue[7] == true)
        {
            timer[7] = setInterval(() => incressTime_7(), 10);
        }
        if(isTrue[8] == true)
        {
            timer[8] = setInterval(() => incressTime_8(), 10);
        }
        if(isTrue[9] == true)
        {
            timer[9] = setInterval(() => incressTime_9(), 10);
        }
        // if(h >= 5 && m >= 50 && s >= 00)
        // {
        //     timer[0] = setInterval(() => incressTime_0(), 10);
        // }
        // if(h >= 9 && m >= 51 && s >= 30){
        //     timer[1] = setInterval(() => incressTime_1(), 10);
        //     timer[2] = setInterval(() => incressTime_2(), 10);
        //     timer[3] = setInterval(() => incressTime_3(), 10);
        //     timer[4] = setInterval(() => incressTime_4(), 10);
        // }
        // if(h >= 9 && m >= 51 && s >= 40){
        //     timer[5] = setInterval(() => incressTime_5(), 10);

        // }
        // if(h >= 9 && m >= 51 && s >= 50){
        //     timer[6] = setInterval(() => incressTime_6(), 10);

        // }
        // if(h >= 9 && m >= 52 && s >= 0){

        //     timer[7] = setInterval(() => incressTime_7(), 10);
        // }
        // if(h >= 9 && m >= 52 && s >= 56){
        //     timer[8] = setInterval(() => incressTime_8(), 10);

        // }
        // if(h >= 9 && m >= 53 && s >= 00){
        //     timer[9] = setInterval(() => incressTime_9(), 10);
        // }

        function incressTime_0() {
            time[0] += 10;
            // time[1] += 10;
            // time[2] += 10;
            // time[3] += 10;
            // time[4] += 10;
            // time[5] += 10;
            // time[6] += 10;
            // time[7] += 10;
            // time[8] += 10;
            // time[9] += 10;

            signal_0(42.29, 119.45, 0);
            // signal_0(26.01, 53.95, 1);
            // signal_0(26.01, 53.95, 2);
            // signal_0(26.01, 53.95, 3);
            // signal_0(26.01, 53.95, 4);
            // signal_0(24.06, 54.85, 5);
            // signal_0(25.06, 102.73, 6);
            // signal_0(24.56, 45.4, 7);
            // signal_0(31.06, 38.87, 8);
            // signal_0(31.04, 38.96, 9);
        }
        function incressTime_1() {
            time[1] += 10;
            signal_0(26.01, 53.95, 1);
        }
        function incressTime_2() {
            time[2] += 10;
            signal_0(26.01, 53.95, 2);
        }
        function incressTime_3() {
            time[3] += 10;
            signal_0(26.01, 53.95, 3);
        }
        function incressTime_4() {
            time[4] += 10;
            signal_0(26.01, 53.95, 4);
        }
        function incressTime_5() {
            time[5] += 10;
            signal_0(24.06, 54.85, 5);
        }
        function incressTime_6() {
            time[6] += 10;
            signal_0(25.06, 102.73, 6);
        }
        function incressTime_7() {
            time[7] += 10;
            signal_0(24.56, 45.4, 7);
        }
        function incressTime_8() {
            time[8] += 10;
            signal_0(31.06, 38.87, 8);
        }
        function incressTime_9() {
            time[9] += 10;
            signal_0(31.04, 38.96, 9);
        }

        function signal_0(on_ts, off_ts, id) {

            let result_On_ts = (on_ts / 0.01) * 10;
            let result_off_ts = (off_ts / 0.01) * 10;

            document.getElementById(id).innerHTML = id + ":" + greenState + ":" + time[id] + ",";
            const db = getDatabase();
            let nowTimes = (time[id] * 0.01) / 10;
            let total = result_On_ts + result_off_ts; //전체 시간

            set(ref(db, 'users/' + id), {
                on: on_ts,
                off: off_ts,
                total: on_ts + off_ts,
                id: id,
                state: greenState,
                nowTime: nowTimes,
            });


            if (time[id] <= total) //1분 59.45초
            {
                if (time[id] <= result_On_ts) //42.29초
                {
                    document.getElementById(id).innerHTML = id + ":" + greenState + ":" + time[id] + ",";
                    set(ref(db, 'users/' + id), {
                        on: on_ts,
                        off: off_ts,
                        total: on_ts + off_ts,
                        id: id,
                        state: greenState,
                        nowTime: nowTimes,
                    });
                }
                else if (time[id] > result_On_ts && time[id] < total) //1분 17.16초
                {
                    document.getElementById(id).innerHTML = id + ":" + redState + ":" + time[id] + ",";
                    set(ref(db, 'users/' + id), {
                        on: on_ts,
                        off: off_ts,
                        total: total,
                        id: id,
                        state: redState,
                        nowTime: nowTimes,
                    });
                }
            }else{
                time[id] = 10;
            }
        }

    </script>
</body>
</html>
